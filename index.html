<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bharat Sanchar AI - Voice Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+Devanagari:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans Devanagari', sans-serif;
        }
        
        /* Typewriter Animation */
        .typewriter {
            overflow: hidden;
            border-right: 3px solid #1a237e;
            white-space: nowrap;
            margin: 0 auto;
            animation: typing 3s steps(20, end), blink-caret 0.75s step-end infinite;
        }
        
        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }
        
        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: #1a237e }
        }
        
        /* Fade in animations */
        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 1s ease-out forwards;
        }
        
        .fade-in-delay-1 { animation-delay: 0.5s; }
        .fade-in-delay-2 { animation-delay: 1s; }
        .fade-in-delay-3 { animation-delay: 1.5s; }
        .fade-in-delay-4 { animation-delay: 2s; }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Microphone glow animation */
        .mic-glow {
            box-shadow: 0 0 20px rgba(15, 157, 88, 0.5);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 20px rgba(15, 157, 88, 0.5); }
            50% { box-shadow: 0 0 30px rgba(15, 157, 88, 0.8); }
            100% { box-shadow: 0 0 20px rgba(15, 157, 88, 0.5); }
        }
        
        /* Listening animation */
        .listening {
            animation: listening-pulse 1s ease-in-out infinite;
        }
        
        @keyframes listening-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* Typing indicator */
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #6b7280;
            margin: 0 2px;
            animation: typing-dots 1.4s infinite ease-in-out;
        }
        
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing-dots {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
        
        /* Chat message animations */
        .message-enter {
            opacity: 0;
            transform: translateY(10px);
            animation: messageEnter 0.3s ease-out forwards;
        }
        
        @keyframes messageEnter {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Custom scrollbar */
        .chat-area::-webkit-scrollbar { width: 6px; }
        .chat-area::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 3px; }
        .chat-area::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .chat-area::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-white min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header Section -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-6xl font-bold text-gray-800 mb-4 typewriter">
                Bharat Sanchar AI
            </h1>
            <p class="text-lg md:text-xl text-gray-600 fade-in fade-in-delay-1">
                Awaaz ke zariye Sarkar se Sanchar
            </p>
        </header>

        <!-- Main Content -->
        <main class="space-y-8">
            <!-- Microphone Section -->
            <section class="text-center fade-in fade-in-delay-2">
                <button id="micButton" class="mic-glow bg-green-600 hover:bg-green-700 text-white rounded-full p-8 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-300">
                    <svg class="w-12 h-12" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd"></path>
                    </svg>
                </button>
                <p id="micStatus" class="mt-4 text-gray-600 font-medium">Speak Your Query</p>
            </section>

            <!-- Fallback Input Section -->
            <section class="fade-in fade-in-delay-3">
                <div class="bg-gray-50 rounded-lg p-6">
                    <label for="queryInput" class="block text-sm font-medium text-gray-700 mb-2">
                        Or type your question:
                    </label>
                    <div class="flex gap-3">
                        <input type="text" id="queryInput" placeholder="Enter your query here..." class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                        <button id="submitButton" class="bg-blue-800 hover:bg-blue-900 text-white px-6 py-3 rounded-lg font-medium transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300">
                            Submit
                        </button>
                    </div>
                </div>
            </section>

            <!-- Chat Output Area -->
            <section class="fade-in fade-in-delay-4">
                <div class="bg-gray-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">AI Response</h3>
                    <div id="chatArea" class="chat-area bg-white rounded-lg p-4 min-h-[200px] max-h-[400px] overflow-y-auto border">
                        <div class="text-gray-500 text-center py-8">
                            Ask a question to get started...
                        </div>
                    </div>
                </div>
            </section>

            <!-- SMS Section -->
            <section class="fade-in fade-in-delay-4">
                <div class="bg-gray-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Send Response via SMS</h3>
                    <div class="flex gap-3">
                        <input type="tel" id="phoneInput" placeholder="Enter phone number (+91XXXXXXXXXX)" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200">
                        <button id="smsButton" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-300">
                            Send via SMS
                        </button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // --- CONFIGURATION ---
        const BACKEND_URL = 'https://bsai-beta.vercel.app'; // Your live backend URL

        // --- DOM ELEMENTS ---
        const micButton = document.getElementById('micButton');
        const micStatus = document.getElementById('micStatus');
        const queryInput = document.getElementById('queryInput');
        const submitButton = document.getElementById('submitButton');
        const chatArea = document.getElementById('chatArea');
        const phoneInput = document.getElementById('phoneInput');
        const smsButton = document.getElementById('smsButton');

        // --- STATE ---
        let isListening = false;
        let recognition = null;
        let lastResponse = '';

        // --- INITIALIZATION ---
        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'hi-IN'; // Hindi language

                recognition.onstart = () => {
                    isListening = true;
                    micButton.classList.add('listening');
                    micButton.style.backgroundColor = '#dc2626'; // Red
                    micStatus.textContent = 'Listening...';
                };

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    queryInput.value = transcript;
                    submitQuery();
                };

                recognition.onend = () => {
                    isListening = false;
                    micButton.classList.remove('listening');
                    micButton.style.backgroundColor = '#16a34a'; // Green
                    micStatus.textContent = 'Speak Your Query';
                };

                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    alert('Speech recognition error: ' + event.error);
                    recognition.onend(); // Reset UI
                };
            } else {
                micButton.disabled = true;
                micStatus.textContent = 'Speech recognition not supported.';
            }
        }

        // --- CORE FUNCTIONS ---
        function startListening() {
            if (!recognition) return;
            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }

        async function submitQuery() {
            const query = queryInput.value.trim();
            if (!query) {
                alert('Please enter a query');
                return;
            }

            // Clear initial message if present
            if (chatArea.children.length === 1 && chatArea.children[0].classList.contains('text-gray-500')) {
                chatArea.innerHTML = '';
            }

            addMessage('user', query);
            showTypingIndicator();

            try {
                const response = await fetch(`${BACKEND_URL}/ask`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: query })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                removeTypingIndicator();
                
                lastResponse = data.answer || 'Sorry, I could not process your request.';
                addMessage('ai', lastResponse);
                
            } catch (error) {
                console.error('Error:', error);
                removeTypingIndicator();
                addMessage('ai', `Sorry, there was an error: ${error.message}`);
            }

            queryInput.value = '';
        }

        async function sendSMS() {
            const phoneNumber = phoneInput.value.trim();
            
            if (!phoneNumber) {
                alert('Please enter a phone number');
                return;
            }
            if (!lastResponse) {
                alert('No response to send. Please ask a question first.');
                return;
            }

            const phoneRegex = /^\+91[6-9]\d{9}$/;
            if (!phoneRegex.test(phoneNumber)) {
                alert('Please enter a valid Indian phone number (e.g., +919876543210)');
                return;
            }

            try {
                const response = await fetch(`${BACKEND_URL}/send-sms`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone: phoneNumber, message: lastResponse })
                });

                const data = await response.json();
                
                if (response.ok) {
                    alert('SMS sent successfully!');
                    phoneInput.value = '';
                } else {
                    throw new Error(data.error || 'Unknown error');
                }
                
            } catch (error) {
                console.error('Error sending SMS:', error);
                alert(`Failed to send SMS: ${error.message}`);
            }
        }

        // --- UI HELPER FUNCTIONS ---
        function addMessage(sender, message) {
            const messageWrapper = document.createElement('div');
            messageWrapper.className = `message-enter mb-4 flex items-end gap-2 ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
            
            const messageContent = document.createElement('div');
            messageContent.className = `inline-block max-w-[80%] p-3 rounded-lg ${sender === 'user' ? 'bg-blue-800 text-white' : 'bg-gray-200 text-gray-800'}`;
            messageContent.textContent = message;

            if (sender === 'ai') {
                const speakerButton = document.createElement('button');
                speakerButton.className = 'p-2 text-gray-600 hover:text-blue-600 transition-colors duration-200 self-start';
                speakerButton.innerHTML = `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M5 7a1 1 0 00-1 1v4a1 1 0 001 1h1l3.293 3.293a1 1 0 001.414-1.414L8.414 12H10a1 1 0 000-2H8.414l2.293-2.293a1 1 0 00-1.414-1.414L6 7H5z"></path><path d="M13 7a1 1 0 011 1v4a1 1 0 11-2 0V8a1 1 0 011-1z"></path></svg>`;
                speakerButton.onclick = () => speakText(message);
                
                messageWrapper.appendChild(messageContent);
                messageWrapper.appendChild(speakerButton);
            } else {
                messageWrapper.appendChild(messageContent);
            }
            
            chatArea.appendChild(messageWrapper);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.className = 'mb-4 text-left';
            typingDiv.innerHTML = `
                <div class="inline-block bg-gray-200 text-gray-800 p-3 rounded-lg">
                    <div class="typing-indicator"><span></span><span></span><span></span></div>
                </div>`;
            chatArea.appendChild(typingDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) typingIndicator.remove();
        }

        function speakText(text) {
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'hi-IN';
                utterance.rate = 0.9;
                speechSynthesis.speak(utterance);
            } else {
                alert('Text-to-speech not supported in this browser');
            }
        }

        // --- EVENT LISTENERS ---
        micButton.addEventListener('click', startListening);
        submitButton.addEventListener('click', submitQuery);
        smsButton.addEventListener('click', sendSMS);
        queryInput.addEventListener('keypress', (e) => e.key === 'Enter' && submitQuery());
        phoneInput.addEventListener('keypress', (e) => e.key === 'Enter' && sendSMS());
        
        // --- STARTUP ---
        document.addEventListener('DOMContentLoaded', initializeSpeechRecognition);

    </script>
</body>
</html>
